<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asset Camera Scanner</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
body {
  margin: 0;
  background: #000;
  font-family: Arial, sans-serif;
}

video {
  width: 100vw;
  height: 100vh;
  object-fit: cover;
}

#status {
  position: fixed;
  top: 0;
  width: 100%;
  padding: 6px 10px;
  background: rgba(0,0,0,0.7);
  color: #fff;
  font-size: 14px;
  z-index: 10;
}

#overlay {
  position: fixed;
  bottom: 0;
  width: 100%;
  max-height: 45%;
  overflow: auto;
  background: rgba(0,0,0,0.85);
  color: #00ff88;
  padding: 12px;
  box-sizing: border-box;
  font-size: 16px;
  z-index: 10;
}
</style>
</head>

<body>

<div id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‚Ä¶</div>
<video id="video" autoplay playsinline></video>
<div id="overlay">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á‚Ä¶</div>

<script>
const video   = document.getElementById("video");
const status  = document.getElementById("status");
const overlay = document.getElementById("overlay");

/* =========================
   1) Google Sheet CSV URL
   ========================= */
const SHEET_URL = "PUT_YOUR_GOOGLE_SHEET_CSV_URL_HERE";

/* =========================
   2) ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheet
   ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏•‡πâ‡∏ß‡∏ô‡πÄ‡∏õ‡πá‡∏ô KEY ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
   ========================= */
let ASSETS = {};

fetch(SHEET_URL)
.then(r => r.text())
.then(csv => {
  const rows = csv.split(/\r?\n/).slice(1);

  rows.forEach(r => {
    if (!r.trim()) return;
    const c = r.split(",");

    const cleanKey = (c[1] || "").replace(/\D/g, "");

    if (cleanKey.length >= 8) {
      ASSETS[cleanKey] = `
        <b>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå:</b> ${cleanKey}<br>
        <b>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</b> ${c[3] || "-"}<br>
        <b>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠:</b> ${c[5] || "-"}<br>
        <b>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç:</b> ${c[6] || "-"}<br>
        <b>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤:</b> ${c[7] || "-"}<br>
        <b>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤:</b> ${c[8] || "-"} ‡∏ö‡∏≤‡∏ó<br>
        <b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> ${c[11] || "-"}
      `;
    }
  });

  status.innerText = "‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß | ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
})
.catch(err => {
  status.innerText = "‡πÇ‡∏´‡∏•‡∏î Google Sheet ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
  console.error(err);
});

/* =========================
   3) ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á
   ========================= */
navigator.mediaDevices.getUserMedia({
  video: { facingMode: "environment" }
})
.then(stream => {
  video.srcObject = stream;
})
.catch(err => {
  status.innerText = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ";
  console.error(err);
});

/* =========================
   4) OCR + ‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠
   ========================= */
let locked = false;

setInterval(async () => {
  if (locked) return;
  if (video.videoWidth === 0) return;

  const canvas = document.createElement("canvas");
  canvas.width  = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video, 0, 0);

  try {
    const result = await Tesseract.recognize(canvas, "eng", {
      tessedit_char_whitelist: "0123456789",
      classify_bln_numeric_mode: 1
    });

    const rawText = result.data.text || "";

    // üîç ‡∏à‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô ‚â• 8 ‡∏´‡∏•‡∏±‡∏Å
    const matches = rawText.match(/\d{8,}/g);

    overlay.innerHTML = "OCR ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ:<br>" + rawText;

    if (!matches) return;

    for (const num of matches) {
      if (ASSETS[num]) {
        locked = true;
        overlay.innerHTML =
          "‚úÖ <b>‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</b><br><br>" +
          ASSETS[num];
        status.innerText = "‡∏û‡∏ö‡πÅ‡∏•‡πâ‡∏ß | ‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô";
        return;
      } else {
        overlay.innerHTML =
          "‚ö†Ô∏è ‡∏û‡∏ö‡πÄ‡∏•‡∏Ç: " + num + "<br>‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
      }
    }

  } catch (e) {
    console.error(e);
  }

}, 2000);
</script>

</body>
</html>
